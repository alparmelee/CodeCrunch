<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DES Expansion (E) Matrix Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better monospace display and readability */
        #binaryInput, #binaryOutput, #hexOutput {
            font-family: 'Inter', monospace;
            font-size: 1.1rem;
            word-break: break-all;
            white-space: pre-wrap;
        }
        .bit-value {
            font-weight: bold;
            color: #1f2937; /* Dark gray */
            font-size: 1.25rem;
        }
        .bit-label {
            font-size: 0.75rem;
            color: #6b7280; /* Medium gray */
            user-select: none;
            display: inline-block;
        }
        .section-header {
            font-size: 1.125rem;
            font-weight: 600;
            margin-top: 1rem;
            color: #10b981; /* Emerald green */
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-4xl bg-white shadow-2xl rounded-xl p-8 space-y-6">
        <h1 class="text-3xl font-extrabold text-center text-gray-800">DES Expansion (E-Matrix) Solver</h1>
        <p class="text-center text-gray-600">Calculates the 48-bit output of the DES E-Matrix given a 32-bit hexadecimal input.</p>
        
        <!-- Input Section -->
        <div class="space-y-4">
            <label for="hexInput" class="block text-lg font-medium text-gray-700">32-bit Hex Input (e.g., 3F6BD297):</label>
            <input type="text" id="hexInput" value="3F6BD297" maxlength="8"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500 text-gray-900 shadow-sm transition duration-150 ease-in-out uppercase"
                   oninput="this.value = this.value.toUpperCase().replace(/[^0-9A-F]/g, '');">
            <button onclick="calculateEBox()"
                    class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-emerald-500 focus:ring-opacity-50">
                Solve Question 2
            </button>
        </div>

        <!-- Output Section -->
        <div class="bg-gray-100 p-6 rounded-lg border border-gray-200">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-2 mb-4">Results & Steps</h2>

            <!-- Final Hex Output -->
            <div class="space-y-2 mb-4">
                <p class="section-header">48-bit Hexadecimal Output (Grouped XX XX XX XX XX XX):</p>
                <div id="hexOutput" class="text-3xl font-extrabold text-red-600 text-center p-3 bg-white rounded-lg border-2 border-dashed border-red-300"></div>
            </div>

            <!-- 32-bit Binary Input -->
            <div class="space-y-2">
                <p class="section-header">Step 1: 32-bit Binary Input (3F6BD297):</p>
                <div id="binaryInput" class="bg-white p-3 rounded-lg border"></div>
            </div>

            <!-- 48-bit Binary Output -->
            <div class="space-y-2 mt-4">
                <p class="section-header">Step 2: 48-bit Binary Output (After E-Matrix):</p>
                <div id="binaryOutput" class="bg-white p-3 rounded-lg border"></div>
            </div>
        </div>

        <!-- E-Matrix Reference -->
        <div class="text-sm text-gray-500 mt-6 pt-4 border-t border-gray-200">
            <p class="font-semibold mb-2">DES Expansion (E) Matrix Permutation Table (1-indexed input positions):</p>
            <div class="overflow-x-auto">
                <pre class="bg-gray-50 p-2 rounded whitespace-pre-wrap text-xs sm:text-sm">
32 1 2 3 4 5  |  4 5 6 7 8 9  |  8 9 10 11 12 13  |  12 13 14 15 16 17
16 17 18 19 20 21  |  20 21 22 23 24 25  |  24 25 26 27 28 29  |  28 29 30 31 32 1
                </pre>
            </div>
        </div>
    </div>

    <script>
        // The DES E-Matrix (Expansion Permutation Table).
        // It specifies which 1-indexed bit from the 32-bit input corresponds to the 48 output bits.
        const E_MATRIX = [
            32, 1, 2, 3, 4, 5, 
            4, 5, 6, 7, 8, 9, 
            8, 9, 10, 11, 12, 13, 
            12, 13, 14, 15, 16, 17, 
            16, 17, 18, 19, 20, 21, 
            20, 21, 22, 23, 24, 25, 
            24, 25, 26, 27, 28, 29, 
            28, 29, 30, 31, 32, 1
        ];

        // --- Core Conversion and Formatting Functions ---

        /**
         * Converts an 8-character hex string to a 32-bit binary string.
         * @param {string} hex - 8-char hex input.
         * @returns {string} 32-bit binary string.
         */
        function hexToBinary(hex) {
            let binary = '';
            for (let i = 0; i < hex.length; i++) {
                // PadStart ensures we get exactly 4 bits per hex digit
                let bits = parseInt(hex[i], 16).toString(2).padStart(4, '0');
                binary += bits;
            }
            return binary;
        }

        /**
         * Applies the E-Matrix permutation to the 32-bit binary input.
         * @param {string} binary32 - The 32-bit binary string input.
         * @returns {string} The 48-bit binary string output.
         */
        function applyEBox(binary32) {
            let binary48 = '';
            // The matrix is 1-indexed, but JavaScript strings are 0-indexed.
            for (const inputBitIndex of E_MATRIX) {
                // inputBitIndex is the 1-based index (1 to 32). Subtract 1 for 0-based string index.
                const stringIndex = inputBitIndex - 1;
                binary48 += binary32[stringIndex];
            }
            return binary48;
        }

        /**
         * Converts the 48-bit binary string to a 12-character hex string, grouped by 2 chars.
         * @param {string} binary48 - The 48-bit binary output.
         * @returns {string} Hex string formatted as "XX XX XX XX XX XX".
         */
        function binaryToHex(binary48) {
            let hex = '';
            // Group the 48 bits into 12 groups of 4 bits (nibbles)
            for (let i = 0; i < 48; i += 4) {
                const nibble = binary48.substring(i, i + 4);
                // Convert the 4-bit nibble to its 1-digit hex representation
                hex += parseInt(nibble, 2).toString(16).toUpperCase();
            }
            // Format for the final output (space between every 2 hex characters)
            return hex.match(/.{1,2}/g).join(' ');
        }
        
        /**
         * Formats binary strings for display with bit position labels.
         * @param {string} binary - The binary string (32 or 48 bits).
         * @param {number[]} positions - Array of 1-indexed bit positions for the labels.
         * @param {number} bitsPerGroup - How many bits to put in a visual group (e.g., 4 for input, 6 for E-Box output).
         * @returns {string} Formatted HTML string.
         */
        function formatBinaryWithLabels(binary, positions, bitsPerGroup) {
            let html = '';
            let labelRow = '<div class="flex flex-wrap">';
            let valueRow = '<div class="flex flex-wrap">';

            for (let i = 0; i < binary.length; i++) {
                const bitValue = binary[i];
                const position = positions[i];

                // Add label (1-indexed position)
                labelRow += `<span class="bit-label w-5 text-center">${position}</span>`;
                
                // Add bit value
                valueRow += `<span class="bit-value w-5 text-center">${bitValue}</span>`;

                // Add visual separator (space)
                if ((i + 1) % bitsPerGroup === 0 && (i + 1) !== binary.length) {
                    labelRow += '<span class="w-5 text-center"> </span>';
                    valueRow += '<span class="w-5 text-center"> </span>';
                }
            }
            labelRow += '</div>';
            valueRow += '</div>';
            
            return labelRow + valueRow;
        }

        // --- Main Calculation Function ---
        
        function calculateEBox() {
            const hexInput = document.getElementById('hexInput').value.trim().toUpperCase();
            const hexOutputEl = document.getElementById('hexOutput');
            const binaryInputEl = document.getElementById('binaryInput');
            const binaryOutputEl = document.getElementById('binaryOutput');

            // Simple validation
            if (hexInput.length !== 8 || !/^[0-9A-F]{8}$/.test(hexInput)) {
                hexOutputEl.textContent = 'Invalid Input: Must be exactly 8 hexadecimal characters.';
                binaryInputEl.innerHTML = '';
                binaryOutputEl.innerHTML = '';
                return;
            }

            // 1. Hex to 32-bit Binary
            const binary32 = hexToBinary(hexInput);
            
            // Create labels for 32-bit input (1 to 32)
            const inputPositions = Array.from({length: 32}, (_, i) => i + 1);
            binaryInputEl.innerHTML = formatBinaryWithLabels(binary32, inputPositions, 4);

            // 2. Apply E-Matrix to get 48-bit Binary
            const binary48 = applyEBox(binary32);
            
            // Format 48-bit output (The labels are the E_MATRIX values, showing which input bit was selected)
            binaryOutputEl.innerHTML = formatBinaryWithLabels(binary48, E_MATRIX, 6);

            // 3. 48-bit Binary to Grouped Hex
            const hexOutput = binaryToHex(binary48);
            
            hexOutputEl.textContent = hexOutput;
        }
        
        // Initialize the calculation on page load with the example
        window.onload = calculateEBox;
    </script>
</body>
</html>
